## Installation

1. Obtain the anonymized data from the authors and keep the data according to the following directory structure:
```
.
├─data
├───data_A_anonymized
├─────food_data
├─────map
├───data_B_anonymized
├─────food_data
├─────map
├───data_C_anonymized
├─────food_data
├─────map
├─results
└─scripts
```

2. Generate the index structures for road networks:
    We use the Hierarchical Hub Labeling code from the following repository [savrus/hl](https://github.com/savrus/hl).  
```bash
    bash scripts/generate_index.sh
```
3. Compile the project:
```bash
    make main.o
```

## Running the code

1. Simulation:  
    - Usage
    ```bash
        ./main.o [-algo algorithm_name] [-city city_name] [-day day_num] [-eta eta_num] [-k k_num] [-gamma gamma_num] [-delta delta_num] [-start start_num] [-end end_num]
    ```
    - The parameters are explained below:
        - **algorithm_name**: Name of assigment algorithm to use \[Default: FM_FULL\]  
        ```
        'GREEDY' = Greedy algorithm
        'HUNGARIAN' = Hungarian algorithm
        'FM_BR' = FoodMatch with only Batching and Reshuffling
        'FM_BFS' = FoodMatch with only Batching and Reshuffling + BFS
        'FM_FULL' = FoodMatch with all optimizations
        'MDRP' = Default algorithm proposed by Reyes et. al. [1,2]
        ```
        - **city_name**: Name of city to run algorithm on \[Default: A\]  
        ```
        '{A, B, C}'
        ```
        - **day_num**: Day for which the algorithm should be run on \[Default: 1\]
        ```
        '{1,2,3,4,5,6}'
        ```
        - **eta_num**: Eta value used in stopping criteria for clustering \[Default: 60\]
        - **k_num**: K value used in fraction of edges to use in BFS \[Default: 200\]
        - **gamma_num**: Gamma value used in weight of heuristic function \[Default: 0.5\]
        - **delta_num**: Accumulation window used \[Default: 180\]
        - **start_num**: Start hour of simulation in 24-hour format \[Default: 12\]
        - **end_num**: End hour of simulation in 24-hour format \[Default: 14\]
    - Sample command:
    ```bash
        ./main.o -algo FM_FULL -city A -day 1 -eta 60 -k 200 -gamma 0.5 -delta 180 -start 12 -end 14 > sim.results
    ```

2. Evaluation:  
    - Usage  
    ```bash
    python3 scripts/evaluation_script.py [--input_file simulation_log] [--output_file output_file] [--start start_num] [--end end_num] [--delta delta_num] 
    ``` 
    - The parameters are explained below:
        - **simulation_log**: Simulation log generated by `main.o` \[Required\]
        - **output_file**: File to which metrics are written \[Required\]
        - **start_num**: Start hour of simulation in 24-hour format \[Required\]
        - **end_num**: End hour of simulation in 24-hour format \[Required\]
        - **delta_num**: Accumulation window used \[Required\]
    - Sample command:
```bash
        python3 scripts/evaluation_script.py --input_file sim.results --output_file metrics.results --start 12 --end 14 --delta 180 
```

## Code Description
- `main.cpp` - contains the code that drives the simulation.<br>
    It produces a log of simulation on stdout. This is piped to a file for evaluation.
- `include/` - contains code for the simulation framework and algorithms.
- `include/constants.cpp` - contains the default parameters used.
- `include/vehicle_assignment.cpp` - contains the code for FoodMatch algorithm.
- `include/vehicle_assignment_baseline.cpp` - contains the code for Greedy and Hungarian algorithm.
- `include/mdrp_baseline.cpp` - contains the code for default algorithm proposed by Reyes et. al. \[1,2\].
- `evaluation_scripts/evaluation_script.py` - reads the simulation log and reports metrics defined in our paper.

## References

[1] Reyes, Damián et al. “The Meal Delivery Routing Problem.” (2018). <br>
[2] Reyes, Damián. Innovations in last-mile delivery systems. PhD Dissertion. Georgia Institute of Technology, May 2018.
